#!/usr/bin/env bash

set -o nounset
set -o pipefail

current="$(git current)"
default="$(git default)"

if [ "${current}" != "${default}" ]; then
    git checkout "${default}"
fi

case "${1}" in
    jira)
        issue="$(echo $2 | awk '{print toupper($0)}')"
        if [ "$(git branch --list | grep "${issue}-")" ]; then
            branch="$(git branch --list | grep "${issue}-" | awk '{print $1}')"
            git checkout "${branch}"
        elif [ "$(git branch --list | grep "${issue}")" ]; then
            git checkout "${issue}"
        else
            branch="$(echo $issue ${@:3} | sed 's/ /-/g')"
            git pull --rebase 2>/dev/null || true
            git checkout -b "${branch}"
        fi
    ;;
    *)
        (>&2 echo nothing to do)
        exit 1
    ;;
esac

echo done
exit 0
