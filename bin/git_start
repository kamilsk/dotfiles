#!/usr/bin/env bash

set -o nounset
set -o pipefail

current=$(git current)
default=$(git default)

if [ "${current}" != "${default}" ]; then
    git checkout "${default}"
fi

case "${1}" in
    "jira")
        issue=$(echo $2 | awk '{print toupper($0)}')
        if [ $(git branch --list | grep "${issue}-") ]; then
            branch=$(git branch --list | grep "${issue}-" | awk '{print $1}')
            git checkout "${branch}"
        else
            branch=$(echo $issue ${@:3} | sed 's/ /-/g')
            git pull --rebase
            git checkout -b "${branch}"
        fi
    ;;
esac

echo done
exit 0
