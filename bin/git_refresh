#!/usr/bin/env bash

set -o nounset
set -o pipefail

current="$(git current)"
default="$(git default)"

if [ "${current}" = "${default}" ]; then
    git pull --all --prune --tags --force --rebase && git submodule update --init --recursive # g+
    exit $?
fi

remote="${1:-$(git current remote)}"
if [ -z "${remote}" ]; then
    (>&2 echo nothing to do because remote is undefined)
    exit 1
fi

if ! git remote | grep "${remote}" > /dev/null; then
    (>&2 echo nothing to do because remote is not found or invalid)
    exit 1
fi

base="${remote}/${default}"
git fetch --all --prune --tags --force
git rebase "${base}"

echo done
exit 0
