#!/usr/bin/env bash

set -o nounset
set -o pipefail

default="$(git default)"

remote="${1:-$(git current remote)}"
if [ -z "${remote}" ]; then
    (>&2 echo nothing to do because remote is undefined)
    exit 1
fi

if ! git remote | grep "${remote}" > /dev/null; then
    (>&2 echo nothing to do because remote is not found or invalid)
    exit 1
fi

base="${remote}/${default}"
git fetch --all --prune --tags --force
git rebase "${base}"

echo done
exit 0
